{% extends 'base2.html' %}
{% load static %}


{% block title %}
    {{ ticker.name }}
{% endblock %}

{% block content %}
    <div>

        <p> Name : {{ ticker.name }}</p>
        <br>
        <p> Symbol : {{ ticker.symbol }} </p>
        <br>
        <p> Bid Price : {{ ticker.bid }} </p>
        <br>
        <p> Ask Price : {{ ticker.ask }} </p>
        <br>
        <p>Username : {{ user.username }} </p>
        <br>
        <p>Your Free Margin : {{ user.profile.free_margin |floatformat:3 }} </p>
        <br>
        <h1>
            {{ state_open_order_status }}
        </h1>
        <!-- Open-->

    <form method="post">
        {% csrf_token %}
        {{ order_open_position_form.as_p }}
        <button name="open_order" type="submit">order</button>
    </form>

    <br>
        <!-- Open Positions-->
        <h1>
            Your Open Positions:
        </h1>
    <br>

        <table class="table">
  <thead>
    <tr>
      <th style="text-align:center" scope="col">ID</th>
      <th style="text-align:center" scope="col">Symbol</th>
      <th style="text-align:center" scope="col">Direction</th>
        <th style="text-align:center" scope="col">Current Quantity</th>
        <th style="text-align:center" scope="col">Open Price</th>
        <th style="text-align:center" scope="col">Blocked Margin</th>
        <th style="text-align:center" scope="col">Unrealized Gain</th>
    </tr>
  </thead>
  <tbody>
   {% for open_position in open_positions %}
    <tr>
      <th style="text-align:center" scope="row">{{ open_position.id }}</th>
      <td style="text-align:center" >{{ open_position.symbol }}</td>
      <td style="text-align:center">{{ open_position.get_direction_display}}</td>
      <td style="text-align:center">{{ open_position.current_quantity }}</td>
      <td style="text-align:center">{{ open_position.matched_price|floatformat:3 }}</td>
      <td style="text-align:center">{{ open_position.blocked_margin|floatformat:3 }}</td>
      <td style="text-align:center">{{ open_position.unrealized_gain|floatformat:3 }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>

        <br>


        <br>
        <h1>
            {{ state_close_order_status }}
        </h1>
        <form method="post">
            {% csrf_token %}
            {{ order_close_position_form.as_p }}
            <button name="close_order" type="submit">Close Position</button>
        </form>

        <h1>
            All published posts about {{ ticker.name }}

        </h1>

        <div>
            {% for post in all_posts %}
                <p>
                    Username : {{ post.user.username }}
                </p>
                <p>
                    Date : {{ post.created_datetime }}
                </p>
                <p>
                    Bid price at the moment of publish : {{ post.related_symbol.bid }}
                </p><p>
                Ask price at the moment of publish : {{ post.related_symbol.ask }}
            </p>
                <p>
                    Text : {{ post.text_content }}
                </p>
                <p>
                    Number of Likes : {{ post.number_of_likes }}
                </p>

                {% if user in post.like_related_users %}
                    <a href="/unlike/{{ post.id }}">Liked</a>
                {% else %}
                    <a href="/like/{{ post.id }}">Like</a>
                {% endif %}
                <br>
            {% endfor %}

        </div>

        <h1>
            {{ state_post_status }}
        </h1>

        <form method="post">
            {% csrf_token %}
            {{ post_form.as_p }}
            <button name="post" type="submit">Post</button>
        </form>
    </div>

{% endblock %}
{% block extra_scripts %}
    <script src="{% static 'paper_trade/datatable.js' %}"></script>
    <script src="{% static 'paper_trade/ticker_page.js' %}"></script>
{% endblock %}